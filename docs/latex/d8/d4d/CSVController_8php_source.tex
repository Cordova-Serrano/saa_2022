\hypertarget{CSVController_8php_source}{}\doxysection{CSVController.\+php}
\label{CSVController_8php_source}\index{app/Http/Controllers/CSVController.php@{app/Http/Controllers/CSVController.php}}
\mbox{\hyperlink{CSVController_8php}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00001}00001 <?php}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00003}00003 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers}{App\(\backslash\)Http\(\backslash\)Controllers}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00005}00005 use DataTables;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00006}00006 use Illuminate\(\backslash\)Http\(\backslash\)Request;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00007}00007 use \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1Controller}{App\(\backslash\)Http\(\backslash\)Controllers\(\backslash\)Controller}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00008}00008 use Maatwebsite\(\backslash\)Excel\(\backslash\)Facades\(\backslash\)Excel;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00009}00009 use \mbox{\hyperlink{classApp_1_1Imports_1_1CSVImport}{App\(\backslash\)Imports\(\backslash\)CSVImport}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00010}00010 use \mbox{\hyperlink{classApp_1_1Models_1_1Student}{App\(\backslash\)Models\(\backslash\)Student}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00011}00011 use \mbox{\hyperlink{classApp_1_1Models_1_1Data}{App\(\backslash\)Models\(\backslash\)Data}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00012}00012 use \mbox{\hyperlink{classApp_1_1Models_1_1Semester}{App\(\backslash\)Models\(\backslash\)Semester}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00013}00013 use \mbox{\hyperlink{classApp_1_1Models_1_1Career}{App\(\backslash\)Models\(\backslash\)Career}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00014}00014 use \mbox{\hyperlink{classApp_1_1Models_1_1File}{App\(\backslash\)Models\(\backslash\)File}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00015}00015 use Illuminate\(\backslash\)Support\(\backslash\)Facades\(\backslash\)DB;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00018}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController}{00018}} \textcolor{keyword}{class }\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController}{CSVController}} \textcolor{keyword}{extends} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1Controller}{Controller}}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00019}00019 \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00020}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_a208abbd215a60cbb4509a658c6a34858}{00020}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_a208abbd215a60cbb4509a658c6a34858}{\_\_construct}}()}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00021}00021     \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00022}00022         \$this-\/>middleware(\textcolor{stringliteral}{'auth'});}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00023}00023     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00024}00024     }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00025}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_a3d142c27c7dcffc58ab4f33fc8cb58d0}{00025}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_a3d142c27c7dcffc58ab4f33fc8cb58d0}{index}}(Request \$request)}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00026}00026     \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00027}00027         \textcolor{keywordflow}{if} (\$request-\/>ajax()) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00028}00028             \$model = File::all();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00030}00030             \textcolor{keywordflow}{return} DataTables::of(\$model)-\/>toJson();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00031}00031         \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00033}00033         \textcolor{keywordflow}{return} view(\textcolor{stringliteral}{'csv.index'});}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00034}00034     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00040}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_ad7f051cec3ecc08f5186201ba08c0b5b}{00040}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \textcolor{keyword}{import}()}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00041}00041     \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00042}00042         \textcolor{keywordflow}{return} view(\textcolor{stringliteral}{'csv.import'});}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00043}00043     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00044}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_af485165d21539f2fbd0b032a8776a993}{00044}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_af485165d21539f2fbd0b032a8776a993}{store}}(Request \$request)}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00045}00045     \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00046}00046         \$doc\_info = pathinfo(request()-\/>file(\textcolor{stringliteral}{'file'})-\/>getClientOriginalName());}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00047}00047         \$extension = \$doc\_info[\textcolor{stringliteral}{'extension'}];}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00048}00048         \$file\_name\_uns = \$doc\_info[\textcolor{stringliteral}{'filename'}]; }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00049}00049         \$file\_name = explode(\textcolor{stringliteral}{"{} "{}}, \$file\_name\_uns); \textcolor{comment}{//separa la cadena en arreglo}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00050}00050         \$excel\_array = Excel::toArray([], request()-\/>file(\textcolor{stringliteral}{'file'})); \textcolor{comment}{//convierte el archivo subido en arreglo}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00051}00051         \textcolor{comment}{//Si el nombre de archivo ya existe, se hace un update}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00052}00052         \$data\_excel = \$excel\_array[0]; \textcolor{comment}{//obtenemos las columnas}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00053}00053         \$no\_process = 0;\textcolor{comment}{//variable para verificar que el excel contiene el numero completo de columnas deacuerdo al formato}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00054}00054         \textcolor{keywordflow}{if}(count(\$data\_excel[0]) != 15) \$no\_process = 1;\textcolor{comment}{//si no tiene las columnas suficientes}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00055}00055         \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00056}00056             \$lenght = count(\$data\_excel);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00057}00057             \textcolor{comment}{//Semester}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00058}00058             \$semester\_str = \$file\_name[1];}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00059}00059             \textcolor{comment}{//Semestre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00060}00060             \textcolor{keywordflow}{if} (isset(Semester::where(\textcolor{stringliteral}{'semester'}, \$semester\_str)-\/>first()-\/>semester)) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00061}00061                 \$semester = Semester::where(\textcolor{stringliteral}{'semester'}, \$semester\_str)-\/>first();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00062}00062                 \$dss = DB::table(\textcolor{stringliteral}{'student\_data\_semester'})-\/>where(\textcolor{stringliteral}{'semester\_id'}, \$semester-\/>id);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00063}00063                 \$dss-\/>delete();     }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00064}00064             \} }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00066}00066             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00067}00067                 \$semester = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1Semester}{Semester}}([}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00068}00068                     \textcolor{stringliteral}{"{}semester"{}} => \$semester\_str,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00069}00069                 ]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00070}00070                 \$semester-\/>save();\textcolor{comment}{//guarda semestre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00071}00071             \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00072}00072             \$error\_array\_s = array();\textcolor{comment}{//arreglo para deteccion de errores de estudiantes}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00073}00073             \$error\_array\_d = array();\textcolor{comment}{//arreglo para deteccion de errores de data}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00074}00074         \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00075}00075         \textcolor{keywordflow}{if} (\$no\_process == 0) }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00076}00076         \{\textcolor{comment}{//si se sube un nuevo semestre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00077}00077             \textcolor{keywordflow}{if}(\$request-\/>is\_update == 0)\{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00078}00078                 \$file = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1File}{File}}([\textcolor{comment}{//se crea registro de FIle}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00079}00079                     \textcolor{stringliteral}{"{}name"{}} => \$file\_name\_uns,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00080}00080                 ]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00081}00081                 \$file-\/>save(); \textcolor{comment}{//se guarda registro}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00082}00082             \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00083}00083             \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00084}00084                 \$file = File::where(\textcolor{stringliteral}{"{}name"{}},\$file\_name\_uns)-\/>first();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00085}00085                 \$file-\/>update();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00086}00086             \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00087}00087             \textcolor{keywordflow}{for} (\$i = 1; \$i < \$lenght; ++\$i) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00088}00088                 \$register\_excel = \$data\_excel[\$i];\textcolor{comment}{//get n register}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00089}00089                 \textcolor{comment}{//Students}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00090}00090                 \$uaslp\_key = \$register\_excel[0];\textcolor{comment}{//clave uaslp}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00091}00091                 \$large\_key = \$register\_excel[1];\textcolor{comment}{//clave larga}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00092}00092                 \$name = \$register\_excel[3];\textcolor{comment}{//nombre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00093}00093                 \$generation\_lk = \textcolor{keyword}{null};\textcolor{comment}{//generacion}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00094}00094                 \$c\_key = \textcolor{keyword}{null};\textcolor{comment}{//clave de clave larga}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00095}00095                 \$ingreso\_lk = \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00096}00096                 \$patron = \textcolor{stringliteral}{"{}/\string^[[:digit:]]+\$/"{}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00097}00097                 \textcolor{keywordflow}{if} (preg\_match(\$patron, \$large\_key)) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00098}00098                     \$generation\_lk = substr(\$large\_key,0,4);\textcolor{comment}{//generacion}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00099}00099                     \$c\_key = substr(\$large\_key,5,2);\textcolor{comment}{//clave de clave larga}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00100}00100                     \$ingreso\_lk = substr(\$large\_key,7,1);\textcolor{comment}{//manera de ingreso a la facultad}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00101}00101                 \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00102}00102                 \$career\_lk = \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00103}00103                 \textcolor{keywordflow}{if}(\$c\_key==\textcolor{stringliteral}{"{}15"{}} || \$c\_key==\textcolor{stringliteral}{"{}47"{}})\textcolor{comment}{//clave 15 de ingenieria en computacion}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00104}00104                 \$career\_lk = \textcolor{stringliteral}{"{}INGENIERÍA EN COMPUTACIÓN"{}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00105}00105                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00106}00106                     \textcolor{keywordflow}{if}(\$c\_key==\textcolor{stringliteral}{"{}23"{}} || \$c\_key==\textcolor{stringliteral}{"{}54"{}}) \textcolor{comment}{//clave 23 de sistemas inteligentes}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00107}00107                     \$career\_lk = \textcolor{stringliteral}{"{}INGENIERÍA EN SISTEMAS INTELIGENTES"{}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00108}00108                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00109}00109                         \textcolor{keywordflow}{if}(\$c\_key==\textcolor{stringliteral}{"{}14"{}})\textcolor{comment}{//clave 14 de informatica}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00110}00110                         \$career\_lk = \textcolor{stringliteral}{"{}INGENIERÍA EN INFORMÁTICA"{}};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00111}00111                 \textcolor{keywordflow}{try} \{\textcolor{comment}{//intenta buscar la carrera}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00112}00112                     \$new\_career = Career::where(\textcolor{stringliteral}{'name'}, \$career\_lk)-\/>first();\textcolor{comment}{//consulta carrera}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00113}00113                 \} \textcolor{keywordflow}{catch} (\(\backslash\)Throwable \$th) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00114}00114                     \textcolor{comment}{//en caso de que no consiga carrera quiere decir que no está bien la clave larga}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00115}00115                     \textcolor{keywordflow}{if}(\$career\_lk != (\textcolor{stringliteral}{"{}15"{}} || \textcolor{stringliteral}{"{}23"{}} || \textcolor{stringliteral}{"{}14"{}} || \textcolor{stringliteral}{"{}47"{}} || \textcolor{stringliteral}{"{}54"{}}))}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00116}00116                     \$career\_lk = \textcolor{keyword}{null};\textcolor{comment}{//no se consiguio una clave de carrera correcta}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00117}00117                     \$new\_career = \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00118}00118                 \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00120}00120                 \textcolor{keywordflow}{if} (!isset(\$new\_career-\/>name) \&\& \$career\_lk != \textcolor{keyword}{null}) \{\textcolor{comment}{//si new\_career no esta seteado y career\_lk es correcto}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00121}00121                     \$new\_career = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1Career}{Career}}([}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00122}00122                         \textcolor{stringliteral}{"{}name"{}} => \$career\_lk,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00123}00123                     ]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00124}00124                     \$new\_career-\/>save();\textcolor{comment}{//guarda el registro de carrera en caso de que la clave se haya detectado de manera correcta}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00125}00125                 \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00126}00126                 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00127}00127                 \textcolor{keywordflow}{if} (isset(Student::where(\textcolor{stringliteral}{'uaslp\_key'}, \$uaslp\_key)-\/>first()-\/>uaslp\_key) ) \{ \textcolor{comment}{//Busca si existe el alumno mediande su clave unica}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00128}00128                     \$flag\_update\_error = 0;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00129}00129                     \$student = Student::where(\textcolor{stringliteral}{'uaslp\_key'}, \$uaslp\_key)-\/>first();\textcolor{comment}{//obtiene el registro del estudiante}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00130}00130                     \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00131}00131                         \$student-\/>large\_key = \$large\_key;\textcolor{comment}{//actualiza clave larga}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00132}00132                         \$student-\/>generation = \$generation\_lk;\textcolor{comment}{//actualiza generacion}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00133}00133                         \$student-\/>name = \$name;\textcolor{comment}{//actualiza nombre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00134}00134                         \$student-\/>career\_id = \$new\_career-\/>id ;\textcolor{comment}{//actualiza carrera id}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00135}00135                         \$student-\/>type = intval(\$ingreso\_lk);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00136}00136                         \$student-\/>update();\textcolor{comment}{//actualiza}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00137}00137                     \} \textcolor{keywordflow}{catch} (\(\backslash\)Throwable \$th) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00138}00138                         \textcolor{comment}{//throw \$th;}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00139}00139                         \$flag\_update\_error = 1;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00140}00140                     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00141}00141                     }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00142}00142                     \$data = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1Data}{Data}}([\textcolor{comment}{//crea el esquema para data}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00143}00143                         \textcolor{stringliteral}{'status'} => \$register\_excel[5],}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00144}00144                         \textcolor{stringliteral}{'creds\_remaining'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[6]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00145}00145                         \textcolor{stringliteral}{'creds\_per\_semester'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[7]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00146}00146                         \textcolor{stringliteral}{'semesters\_completed'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[8]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00147}00147                         \textcolor{stringliteral}{'percentage\_progress'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[9]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00148}00148                         \textcolor{stringliteral}{'general\_average'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[10]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00149}00149                         \textcolor{stringliteral}{'general\_performance'} =>\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[11]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00150}00150                         \textcolor{stringliteral}{'app\_average'}=>\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[12]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00151}00151                         \textcolor{stringliteral}{'subjects\_approved'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[13]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00152}00152                         \textcolor{stringliteral}{'subjects\_failed'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[14]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00153}00153                     ]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00154}00154                     }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00155}00155                     \textcolor{keywordflow}{try} \{\textcolor{comment}{//intenta guardar semestre, data de alumno y student}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00156}00156                         \textcolor{keywordflow}{if}(\$flag\_update\_error == 0)\{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00157}00157                             \$semester-\/>save();\textcolor{comment}{//guarda semestre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00158}00158                             \$data-\/>save();\textcolor{comment}{//guarda data}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00159}00159                             \$student-\/>data()-\/>attach(\$data-\/>id, [\textcolor{stringliteral}{'semester\_id'} => \$semester-\/>id, \textcolor{stringliteral}{'file\_id'} => \$file-\/>id]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00160}00160                         \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00161}00161                     \} \textcolor{keywordflow}{catch} (\(\backslash\)Throwable \$th) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00162}00162                         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00163}00163                     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00164}00164                 \} \textcolor{keywordflow}{else} \{\textcolor{comment}{//si no hay alumno en registro, crea uno nuevo}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00165}00165                     \textcolor{keywordflow}{if} (\$new\_career)\{\textcolor{comment}{//comprueba que new career no sea null}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00166}00166                     \$student = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1Student}{Student}}([}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00167}00167                         \textcolor{stringliteral}{"{}uaslp\_key"{}} => \$uaslp\_key,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00168}00168                         \textcolor{stringliteral}{"{}large\_key"{}} => \$large\_key,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00169}00169                         \textcolor{stringliteral}{"{}generation"{}} => \$generation\_lk,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00170}00170                         \textcolor{stringliteral}{"{}name"{}} => \$name,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00171}00171                         \textcolor{stringliteral}{"{}career\_id"{}} => \$new\_career-\/>id,}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00172}00172                         \textcolor{stringliteral}{"{}type"{}} => intval(\$ingreso\_lk),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00173}00173                     ]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00174}00174                     \$data = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1Data}{Data}}([\textcolor{comment}{//guarda registro de data de semestre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00175}00175                         \textcolor{stringliteral}{'status'} => \$register\_excel[5],}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00176}00176                         \textcolor{stringliteral}{'creds\_remaining'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[6]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00177}00177                         \textcolor{stringliteral}{'creds\_per\_semester'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[7]), }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00178}00178                         \textcolor{stringliteral}{'semesters\_completed'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[8]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00179}00179                         \textcolor{stringliteral}{'percentage\_progress'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[9]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00180}00180                         \textcolor{stringliteral}{'general\_average'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[10]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00181}00181                         \textcolor{stringliteral}{'general\_performance'} =>\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[11]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00182}00182                         \textcolor{stringliteral}{'app\_average'}=>\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[12]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00183}00183                         \textcolor{stringliteral}{'subjects\_approved'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[13]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00184}00184                         \textcolor{stringliteral}{'subjects\_failed'} => \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$register\_excel[14]),}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00185}00185                     ]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00186}00186                     \$fs=0;\textcolor{comment}{//bandera para verificar error}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00187}00187                     \$semester-\/>save();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00188}00188                     \textcolor{keywordflow}{try} \{\textcolor{comment}{//intenta guardar registro de students}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00189}00189                         \$student-\/>save();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00190}00190                         }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00191}00191                     \} \textcolor{keywordflow}{catch} (\(\backslash\)Throwable \$th) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00192}00192                         \$fs = 1;\textcolor{comment}{//cuando hay error en students cambia la bandera para no guardar su data}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00193}00193                         array\_push(\$error\_array\_s,\$i + 1); \textcolor{comment}{//deteccion de errores en students}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00194}00194                     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00195}00195                     \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00196}00196                         \textcolor{keywordflow}{if}(\$fs == 0)\{\textcolor{comment}{//en caso de que los datos de alumno sean correctos}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00197}00197                             \$data-\/>save(); }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00198}00198                             \$student-\/>data()-\/>attach(\$data-\/>id, [\textcolor{stringliteral}{'semester\_id'} => \$semester-\/>id, \textcolor{stringliteral}{'file\_id'} => \$file-\/>id]);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00199}00199                         \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00200}00200                         }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00201}00201                     \} \textcolor{keywordflow}{catch} (\(\backslash\)Throwable \$th) \{\textcolor{comment}{//si hay error en data, borra el registro de estudiante}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00202}00202                         DB::table(\textcolor{stringliteral}{'students'})-\/>}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00203}00203                         orderBy(\textcolor{stringliteral}{'id'}, \textcolor{stringliteral}{'desc'})-\/>limit(1)-\/>delete();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00204}00204                         array\_push(\$error\_array\_d,\$i + 1);\textcolor{comment}{//deteccion de errores en data}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00205}00205                     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00206}00206 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00207}00207                 \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00208}00208                 unset(\$student);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00209}00209                 unset(\$data);}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00210}00210             \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00211}00211                 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00212}00212             \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00213}00213         \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00214}00214         }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00215}00215         \textcolor{keywordflow}{return} redirect()-\/>route(\textcolor{stringliteral}{'csv.index'})-\/>with(\textcolor{stringliteral}{'success'}, \textcolor{stringliteral}{'El archivo csv ha sido importado con éxito.'});}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00216}00216     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00217}00217 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00218}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_a3cce9818607745438afe2e48baab62f1}{00218}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1CSVController_a3cce9818607745438afe2e48baab62f1}{updateDoc}}(Request \$request)}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00219}00219     \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00220}00220         \textcolor{keywordflow}{if} (\$request-\/>ajax()) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00221}00221             \$file\_name\_uns = pathinfo(\$request-\/>filename, PATHINFO\_FILENAME); \textcolor{comment}{//obtiene el nombre del archivo sin extencion}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00222}00222             \$file\_name = explode(\textcolor{stringliteral}{"{} "{}}, \$file\_name\_uns); \textcolor{comment}{//separa la cadena en arreglo}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00223}00223             \textcolor{comment}{//Revisar si existe un archivo con el mismo nombre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00224}00224             \$file = File::where(\textcolor{stringliteral}{'name'}, \textcolor{charliteral}{'='}, \$file\_name\_uns)-\/>first();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00225}00225             \textcolor{comment}{//Revisar si existe un semestre}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00226}00226             \$semester = Semester::where(\textcolor{stringliteral}{'semester'}, \textcolor{charliteral}{'='}, \$file\_name)-\/>first();}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00227}00227             \textcolor{keywordflow}{if} (\$file) \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00228}00228                 \textcolor{comment}{//Existe el archivo}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00229}00229                 \$response = 1;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00230}00230             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00231}00231                 \textcolor{comment}{//No existe, no sobrescribir}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00232}00232                 \$response = 0;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00233}00233             \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00235}00235             \textcolor{keywordflow}{return} \$response;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00236}00236         \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00237}00237     \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00238}00238 \}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00239}\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{00239}} \textcolor{keyword}{function} \mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers_a12b1268c7a6b4bb4f1c164bbfe3004d4}{check\_value}}(\$v)\{\textcolor{comment}{//evalua el valor recibido como parametro}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00240}00240     \textcolor{keywordflow}{if}(\$v != \textcolor{keyword}{null})\textcolor{comment}{//en caso de que sea null, lo asigna a la variable }}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00241}00241         \$cr = \$v;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00242}00242     \textcolor{keywordflow}{else}\textcolor{comment}{//si es null, lo asigna como 0}}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00243}00243         \$cr = 0;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00244}00244     \textcolor{keywordflow}{return} \$cr;}
\DoxyCodeLine{\Hypertarget{CSVController_8php_source_l00245}00245     \} }

\end{DoxyCode}
