\hypertarget{UserController_8php_source}{}\doxysection{User\+Controller.\+php}
\label{UserController_8php_source}\index{app/Http/Controllers/UserController.php@{app/Http/Controllers/UserController.php}}
\mbox{\hyperlink{UserController_8php}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00001}00001 <?php}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00003}00003 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespaceApp_1_1Http_1_1Controllers}{App\(\backslash\)Http\(\backslash\)Controllers}};}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00005}00005 use DataTables;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00006}00006 use Illuminate\(\backslash\)Http\(\backslash\)Request;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00007}00007 use \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1Controller}{App\(\backslash\)Http\(\backslash\)Controllers\(\backslash\)Controller}};}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00008}00008 use \mbox{\hyperlink{classApp_1_1Models_1_1Role}{App\(\backslash\)Models\(\backslash\)Role}};}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00009}00009 use \mbox{\hyperlink{classApp_1_1Models_1_1RoleUser}{App\(\backslash\)Models\(\backslash\)RoleUser}};}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00010}00010 use \mbox{\hyperlink{classApp_1_1Providers_1_1RouteServiceProvider}{App\(\backslash\)Providers\(\backslash\)RouteServiceProvider}};}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00011}00011 use \mbox{\hyperlink{classApp_1_1Models_1_1User}{App\(\backslash\)Models\(\backslash\)User}};}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00012}00012 use Illuminate\(\backslash\)Foundation\(\backslash\)Auth\(\backslash\)RegistersUsers;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00013}00013 use Illuminate\(\backslash\)Support\(\backslash\)Facades\(\backslash\)Hash;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00014}00014 use Illuminate\(\backslash\)Support\(\backslash\)Facades\(\backslash\)Validator;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00017}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController}{00017}} \textcolor{keyword}{class }\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController}{UserController}} \textcolor{keyword}{extends} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1Controller}{Controller}}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00018}00018 \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00019}00019 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00020}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_ace529377bf5e5650771ffc907238efcf}{00020}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_ace529377bf5e5650771ffc907238efcf}{index}}(Request \$request)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00021}00021     \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00022}00022         \textcolor{keywordflow}{if} (\$request-\/>ajax()) \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00023}00023             \$model = User::with(\textcolor{stringliteral}{'roles'})-\/>get();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00025}00025             \textcolor{keywordflow}{return} DataTables::of(\$model)-\/>toJson();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00026}00026         \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00027}00027         \textcolor{comment}{// \$model = User::with('roles')-\/>get();}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00028}00028         \textcolor{comment}{// dd(\$model);}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00029}00029         \textcolor{keywordflow}{return} view(\textcolor{stringliteral}{'users.index'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00030}00030     \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00036}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a94b2b27265dde4a06a2c9927a929d43f}{00036}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a94b2b27265dde4a06a2c9927a929d43f}{create}}()}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00037}00037     \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00038}00038         \textcolor{keywordflow}{return} view(\textcolor{stringliteral}{'users.create'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00039}00039     \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00046}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a4a1f0ad2fa2324b420f899dcaf9a8a8d}{00046}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a4a1f0ad2fa2324b420f899dcaf9a8a8d}{edit}}(\mbox{\hyperlink{classApp_1_1Models_1_1User}{User}} \$user)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00047}00047     \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00048}00048         \textcolor{comment}{//dd(\$user-\/>roles[0]-\/>name);}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00049}00049         \textcolor{comment}{//\$rol = RoleUser::where('user\_id', \$user-\/>id)-\/>first();}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00050}00050         \textcolor{comment}{//dd(\$rol);}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00051}00051         \textcolor{keywordflow}{return} view(\textcolor{stringliteral}{'users.edit'}, compact(\textcolor{stringliteral}{'user'}, \$user));}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00052}00052     \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00060}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a51c9ed95177aed399acdebcb07da6475}{00060}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a51c9ed95177aed399acdebcb07da6475}{update}}(Request \$request)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00061}00061     \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00062}00062         \$id = \$request-\/>id;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00063}00063         \$user = User::where(\textcolor{stringliteral}{'id'}, \$id)-\/>first();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00064}00064         \textcolor{keywordflow}{if}(User::where(\textcolor{stringliteral}{'email'},\$request-\/>email)-\/>exists() \&\& \$user-\/>email != \$request-\/>email)\{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00065}00065             \textcolor{keywordflow}{return} back()-\/>with(\textcolor{stringliteral}{'duplicated'}, \textcolor{stringliteral}{'El correo ingresado ya existe. Por favor, ingrese un correo diferente'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00066}00066         \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00067}00067         \$validated = \$request-\/>validate([}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00068}00068             \textcolor{stringliteral}{'name'} => \textcolor{stringliteral}{'required|max:100'},}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00069}00069             \textcolor{stringliteral}{'username'} => \textcolor{stringliteral}{'required|max:100'},}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00070}00070             \textcolor{stringliteral}{'email'} => \textcolor{stringliteral}{'required|email:rfc'},}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00071}00071             \textcolor{stringliteral}{'password'} => \textcolor{stringliteral}{'required|min:8|alpha\_num'}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00072}00072         ]);}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00073}00073         \textcolor{comment}{//\$id = \$request-\/>id;}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00074}00074         \textcolor{comment}{//\$user = User::where('id', \$id)-\/>first();}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00075}00075         \$user-\/>name = \$request-\/>name;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00076}00076         \$user-\/>email = \$request-\/>email;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00077}00077         \$user-\/>username = \$request-\/>username;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00078}00078         \$user-\/>password = bcrypt(\$request-\/>password);}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00079}00079         \$user-\/>save();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00081}00081         \$role = RoleUser::where(\textcolor{stringliteral}{'user\_id'}, \$id)-\/>first();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00082}00082         \$role-\/>role\_id = \$request-\/>role;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00083}00083         \$role-\/>save();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00084}00084         \textcolor{keywordflow}{return} redirect()-\/>route(\textcolor{stringliteral}{'users.index'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00085}00085     \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00092}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a25d8745c27f95ad4ff14955be6bc12d3}{00092}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a25d8745c27f95ad4ff14955be6bc12d3}{store}}(Request \$request)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00093}00093     \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00094}00094         \textcolor{keywordflow}{if}(User::where(\textcolor{stringliteral}{'email'},\$request-\/>email)-\/>exists())\{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00095}00095             \textcolor{keywordflow}{return} redirect()-\/>route(\textcolor{stringliteral}{'users.create'})-\/>with(\textcolor{stringliteral}{'duplicated'}, \textcolor{stringliteral}{'El correo ingresado ya existe. Por favor, ingrese un correo diferente'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00096}00096         \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00097}00097         \$role = 0;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00098}00098         \$validated = \$request-\/>validate([}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00099}00099             \textcolor{stringliteral}{'name'} => \textcolor{stringliteral}{'required|max:100'},}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00100}00100             \textcolor{stringliteral}{'username'} => \textcolor{stringliteral}{'required|max:100'},}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00101}00101             \textcolor{stringliteral}{'email'} => \textcolor{stringliteral}{'required|email:rfc'},}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00102}00102             \textcolor{stringliteral}{'password'} => \textcolor{stringliteral}{'required|min:8|alpha\_num'}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00103}00103         ]);}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00104}00104         \$user = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1User}{User}}([}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00105}00105             \textcolor{stringliteral}{"{}name"{}} => \$request-\/>name,}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00106}00106             \textcolor{stringliteral}{"{}username"{}} => \$request-\/>username,}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00107}00107             \textcolor{stringliteral}{"{}email"{}} => \$request-\/>email,}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00108}00108             \textcolor{stringliteral}{"{}password"{}} => bcrypt(\$request-\/>password)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00109}00109         ]);}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00110}00110         \$user-\/>save();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00111}00111         \textcolor{keywordflow}{if}(\$request-\/>role == \textcolor{stringliteral}{"{}super"{}})}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00112}00112             \$role = 1;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00113}00113         elseif(\$request-\/>role == \textcolor{stringliteral}{"{}admin"{}})}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00114}00114             \$role = 2;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00115}00115         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00116}00116             \$role = 3;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00117}00117         \$role\_user = \textcolor{keyword}{new} \mbox{\hyperlink{classApp_1_1Models_1_1RoleUser}{RoleUser}}([}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00118}00118             \textcolor{stringliteral}{"{}user\_id"{}} => \$user-\/>id,}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00119}00119             \textcolor{stringliteral}{"{}role\_id"{}} => \$role}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00120}00120         ]);}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00121}00121         \$role\_user-\/>save();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00122}00122         \textcolor{keywordflow}{return} view(\textcolor{stringliteral}{'users.index'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00123}00123     \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00124}00124 }
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00130}\mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a685566fea36949164e696f246186cbfa}{00130}}     \textcolor{keyword}{public} \textcolor{keyword}{function} \mbox{\hyperlink{classApp_1_1Http_1_1Controllers_1_1UserController_a685566fea36949164e696f246186cbfa}{destroy}}(\mbox{\hyperlink{classApp_1_1Models_1_1User}{User}} \$user)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00131}00131     \{}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00132}00132         \$id = \$user-\/>id;}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00133}00133         \$role\_table = RoleUser::where(\textcolor{stringliteral}{'user\_id'}, \$id)-\/>first();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00134}00134         \textcolor{keywordflow}{if}(\$role\_table-\/>role\_id == 1)}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00135}00135             \textcolor{keywordflow}{return} redirect()-\/>route(\textcolor{stringliteral}{'users.index'})-\/>with(\textcolor{stringliteral}{'error'}, \textcolor{stringliteral}{'No se puede eliminar al superusuario'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00136}00136         \$role\_table-\/>delete();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00137}00137         \$user\_table = User::where(\textcolor{stringliteral}{'id'}, \$id)-\/>first();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00138}00138         \$user\_table-\/>delete();}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00139}00139         \textcolor{keywordflow}{return} redirect()-\/>route(\textcolor{stringliteral}{'users.index'});}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00140}00140     \}}
\DoxyCodeLine{\Hypertarget{UserController_8php_source_l00141}00141 \}}

\end{DoxyCode}
